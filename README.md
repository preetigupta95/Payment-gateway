## Checkout Documentation

# Install

```bash
npm install checkout-sdk-node
```

# Import

```js
// ES6:
import { Checkout } from 'checkout-sdk-node';
// Common JS:
const { Checkout } = require('checkout-sdk-node');
```

> If you don't have your API keys, you can sign up for a test account [here](https://www.checkout.com/get-test-account).

# Initialize SDK

## With api keys or access credentials
Based on how your account was set up, you will either have a pair or API key or a set of access credentials. Here is how you can use the SDK in both scenarios:
```js
// API Keys
const cko = new Checkout('sk_XXXXXXXXX', {
    pk: 'pk_XXXXXXX'
});

// Access credentials
const cko = new Checkout('your api secret here', {
    client: 'ack_XXXXXXXX',
    scope: ['gateway'], // or whatever scope required
    environment: 'sandbox', // or 'production'
});
```

## With environment variables
If your account uses API Keys (pk_XXX + sk_XXX), you can set the following environment variables, and the SK will pick them up:
- *CKO_SECRET_KEY*    (with a value like sk_XXX)
- *CKO_PUBLIC_KEY*   (with a value like pk_XXX)

If you use access credentials (ack_XXXX), you can set the following environment variables, and the SK will pick them up:
- *CKO_SECRET*
- *CKO_CLIENT*   (with a value like ack_XXXX)
- *CKO_SCOPE*   (with a value of the scope or semicolon separated scopes in case you use multiple)
- *CKO_ENVIRONMENT*   (with a value like sandbox or production)

## Set custom config
Basides the authentication, you also have the option to configure some extra elements about the SDK 
```js
const cko = new Checkout('...', {
    ..., //other authentication config
    host: "https://myProxyExample.com", // in case you need to use a custom host for tests
    timeout: 60000,   // HTTP request timout in ms
    agent: new http.Agent({ keepAlive: true }) // custom HTTP agent
});
```

# SDK Environment (Sandbox/Production)
When using API Keys (pk_XXX + sk_XXX) the SDK will automatically figure out what environment you are using however, if you use access credentials (ack_XXXX), make sure you set the "environment" in the config, as shown above in the initialization. 

# Error handling
The SDK is using promises, and you can handle errors similar to any other HTTP call.

```js
try {
    // some async request made with the SDK
    const action = await cko.payments.request({...});
    ...
} catch (error) {
    console.log(error.name, error.http_code, error.body)
    switch (error.name) {
        ...
    }
}
```
Here you have all the possible SDK specific errors:

| error.name           | error.http_code | error.body              |
| -------------------- | --------------- | ----------------------- |
| AuthenticationError  | 401             | undefined               |
| ActionNotAllowed     | 403             | undefined               |
| UrlAlreadyRegistered | 409             | undefined               |
| NotFoundError        | 404             | undefined               |
| BadGateway           | 502             | undefined               |
| ValidationError      | 422             | object                  |
| TooManyRequestsError | 429             | object/undefined        |
| ValueError           | 429             | string describing error |


# Examples of usage

You can see examples of how to use the SDK for every endpoint documented in our  [API Reference](https://api-reference.checkout.com/). All you have to do is to navigate to the endpoint you want to use, and select "Node" for the example on the right side.
> NOTE: If you use access credentials (ack_XXXX) the link to the API reference relevant to you will be shared by your Solutions Engineers. 

## Create Card Instrument
```js
import { Checkout } from 'checkout-sdk-node';

let cko = new Checkout('your_client_secret_here', {
	client: 'ack_XXXXXXXXXXXX',
	scope: ['gateway'], // array of scopes
	environment: 'sandbox', // or "production"
});

// Or if you use api keys:
// const cko = new Checkout('sk_sbox_XXX', { pk: 'pk_sbox_XXX'}});

try {
	const instrument = await cko.instruments.create({
		// infered type "token",
		token: 'tok_bzi43qc6jeee5mmnfo4gnsnera', // Generated by Checkout.Frames
	});
```

## Create Bank Instrument

```js
import { Checkout } from 'checkout-sdk-node';

let cko = new Checkout('your_client_secret_here', {
	client: 'ack_XXXXXXXXXXXX',
	scope: ['gateway'], // array of scopes
	environment: 'sandbox', // or "production"
});

// Or if you use api keys:
// const cko = new Checkout('sk_sbox_XXX', { pk: 'pk_sbox_XXX'}});
const data = {
  "type": "bank_account",
  "account_type": "savings",
  "account_number": "13654567455",
  "bank_code": "123-456",
  "branch_code": "6443",
  "iban": "HU93116000060000000012345676",
  "bban": "3704 0044 0532 0130 00",
  "swift_bic": "37040044",
  "currency": "GBP",
  "country": "GB",
  "account_holder": {
    "type": "individual",
    "first_name": "John",
    "last_name": "Smith",
    "company_name": "Acme Corporation",
    "tax_id": "123456",
    "date_of_birth": "1986-01-01",
    "country_of_birth": "GB",
    "residential_status": "resident",
    "billing_address": {
      "address_line1": "123 High St.",
      "address_line2": "Flat 456",
      "city": "London",
      "zip": "SW1A 1AA",
      "country": "GB"
    },
    "phone": {
      "country_code": "+44",
      "number": "1234 567890"
    },
    "identification": {
      "type": "passport",
      "number": "09876",
      "issuing_country": "US"
    },
    "email": "john.smith@example.com"
  },
  "bank": {
    "name": "Test Bank",
    "branch": "Main branch",
    "address": {
      "address_line1": "Example Place",
      "address_line2": "Example Square",
      "city": "London",
      "zip": "EC2M 4XY",
      "country": "GB"
    }
  },
  "customer": {
    "id": "cus_y3oqhf46pyzuxjbcn2giaqnb44",
    "email": "jane.smith@example.com",
    "name": "Jane Smith"
  }
}

try {
	const instrument = await cko.instruments.create(data);
} catch (err) {
	console.log(err.name);
}
```
## Create Payment from Card

```js
import { Checkout } from 'checkout-sdk-node';

let cko = new Checkout('your_client_secret_here', {
	client: 'ack_XXXXXXXXXXXX',
	scope: ['gateway'], // array of scopes
	environment: 'sandbox', // or "production"
});

// Or if you use api keys:
// const cko = new Checkout('sk_sbox_XXX', { pk: 'pk_sbox_XXX'}});

try {
	const payment = await cko.payments.request({
		source: {
			// inferred type: "token"
			token: 'tok_bzi43qc6jeee5mmnfo4gnsnera', // Generated by Checkout.Frames
			billing_address: {
				address_line1: 'Wall Street',
				address_line2: 'Dollar Avenue',
				city: 'London',
				state: 'London',
				zip: 'W1W W1W',
				country: 'GB',
			},
			phone: {
				country_code: '44',
				number: '7123456789',
			},
		},
		currency: 'USD',
		amount: 1000,
		payment_type: 'Regular',
		reference: 'ORDER 1234',
		description: 'Mint Tea',
		customer: {
			email: 'new_user@email.com',
			name: 'John Smith',
		},
		metadata: {
			value: 'My value',
		},
	});
} catch (err) {
	console.log(err.name);
}
```
